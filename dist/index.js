var S=Object.create;var p=Object.defineProperty;var B=Object.getOwnPropertyDescriptor;var K=Object.getOwnPropertyNames;var z=Object.getPrototypeOf,E=Object.prototype.hasOwnProperty;var U=(t,e)=>{for(var o in e)p(t,o,{get:e[o],enumerable:!0})},x=(t,e,o,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of K(e))!E.call(t,n)&&n!==o&&p(t,n,{get:()=>e[n],enumerable:!(r=B(e,n))||r.enumerable});return t};var d=(t,e,o)=>(o=t!=null?S(z(t)):{},x(e||!t||!t.__esModule?p(o,"default",{value:t,enumerable:!0}):o,t)),j=t=>x(p({},"__esModule",{value:!0}),t);var G={};U(G,{default:()=>L});module.exports=j(G);var c=require("electron"),l=d(require("qs")),w=d(require("url"));function y(...t){return e=>t.reduce((o,r)=>({...o,...r(e)}),{})}function I(t){return function(e){return o=>e(t,o)}}var s=(t,e)=>({[t]:e});var q=t=>{let e={width:800,height:800,alwaysOnTop:!0};return s("authWindow",{login:async o=>new Promise((r,n)=>{var u,h;let a=`https://${t.auth0.domain}/authorize?`+l.default.stringify({audience:t.auth0.audience,scope:t.auth0.scopes,response_type:"code",client_id:t.auth0.clientId,code_challenge:o.challenge,code_challenge_method:"S256",redirect_uri:`https://${t.auth0.domain}/mobile`,...(u=t.login)==null?void 0:u.authorizeParams}),i=new c.BrowserWindow({...e,title:"Login",...(h=t.login)==null?void 0:h.windowConfig});i.webContents.on("did-navigate",(M,$)=>{let g=w.default.parse($);if(g.pathname=="/mobile"){let v=l.default.parse(g.search||"",{ignoreQueryPrefix:!0});r(v.code),i.destroy()}}),i.on("close",()=>{n("Auth flow is rejected")}),i.loadURL(a)}),logout:async()=>new Promise((o,r)=>{var i;let n=null,a=new c.BrowserWindow({...e,title:"Log out",skipTaskbar:!0,show:!1,frame:!1,...(i=t.logout)==null?void 0:i.windowConfig});a.webContents.on("did-navigate",()=>{a.destroy(),n&&clearTimeout(n),o()}),a.loadURL(`https://${t.auth0.domain}/v2/logout`),n=setTimeout(()=>{r(new Error("Logout time out"))},60*1e3)})})},C=q;var m=d(require("crypto"));function A(t){return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function J(t){return m.default.createHash("sha256").update(t).digest().toString("base64")}function N(t){return m.default.randomBytes(t).toString("base64")}var D=t=>s("cryptography",{getPKCEChallengePair:()=>{let e=N(32),o=A(e),r=A(J(o));return{verifier:o,challenge:r}}}),P=D;var k=()=>Date.now()/1e3,H=()=>{let t=null,e;return s("tokens",{async get(){return t},async set(o){t=o,e=k()+o.expires_in},async delete(){t=null},expiredIn:()=>e?e-k():1/0})},_=H;var Q=t=>s("authAPI",{exchangeAuthCode:(e,o)=>fetch(`https://${t.auth0.domain}/oauth/token`,{method:"POST",body:JSON.stringify({grant_type:"authorization_code",client_id:t.auth0.clientId,code_verifier:o.verifier,code:e,redirect_uri:`https://${t.auth0.domain}/mobile`})}).then(r=>r.json()),getProfile:e=>fetch(`https://${t.auth0.domain}/userinfo`,{headers:{Authorization:`Bearer ${e}`}}).then(o=>o.json())}),b=Q;async function f(t){let{cryptography:e,authWindow:o,authAPI:r,tokens:n}=t,a=e.getPKCEChallengePair(),i=await o.login(a),u=await r.exchangeAuthCode(i,a);return n.set(u),u.access_token}async function O(t){let{tokens:e}=t,o=await e.get();return o&&e.expiredIn()>60?o.access_token:f(t)}async function T(t){let{authWindow:{logout:e},tokens:o}=t;await Promise.all([o.delete(),e()])}async function W(t){let{tokens:e,authAPI:o}=t,r=await e.get();return r?o.getProfile(r.access_token):null}function F(t,e){let o=I(t(e));return{getToken:o(O),getProfile:o(W),login:o(f),logout:o(T)}}var R=F;function L(t){let e=y(C,P,_,b);return R(e,t)}
//# sourceMappingURL=index.js.map