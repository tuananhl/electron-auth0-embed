var B=Object.create;var d=Object.defineProperty;var K=Object.getOwnPropertyDescriptor;var j=Object.getOwnPropertyNames;var z=Object.getPrototypeOf,E=Object.prototype.hasOwnProperty;var U=(t,e)=>{for(var o in e)d(t,o,{get:e[o],enumerable:!0})},x=(t,e,o,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of j(e))!E.call(t,n)&&n!==o&&d(t,n,{get:()=>e[n],enumerable:!(r=K(e,n))||r.enumerable});return t};var c=(t,e,o)=>(o=t!=null?B(z(t)):{},x(e||!t||!t.__esModule?d(o,"default",{value:t,enumerable:!0}):o,t)),q=t=>x(d({},"__esModule",{value:!0}),t);var V={};U(V,{default:()=>$});module.exports=q(V);var l=require("electron"),m=c(require("qs")),I=c(require("url"));function y(...t){return e=>t.reduce((o,r)=>({...o,...r(e)}),{})}function A(t){return function(e){return o=>e(t,o)}}var a=(t,e)=>({[t]:e});var J=t=>{let e={width:800,height:800,alwaysOnTop:!0};return a("authWindow",{login:async o=>new Promise((r,n)=>{var u,p;let s=`https://${t.auth0.domain}/authorize?`+m.default.stringify({audience:t.auth0.audience,scope:t.auth0.scopes,response_type:"code",client_id:t.auth0.clientId,code_challenge:o.challenge,code_challenge_method:"S256",redirect_uri:`https://${t.auth0.domain}/mobile`,...(u=t.login)==null?void 0:u.authorizeParams}),i=new l.BrowserWindow({...e,title:"Login",...(p=t.login)==null?void 0:p.windowConfig});i.webContents.on("did-navigate",(X,v)=>{let h=I.default.parse(v);if(h.pathname=="/mobile"){let S=m.default.parse(h.search||"",{ignoreQueryPrefix:!0});r(S.code),i.destroy()}}),i.on("close",()=>{n("Auth flow is rejected")}),i.loadURL(s)}),logout:async()=>new Promise((o,r)=>{var i;let n=null,s=new l.BrowserWindow({...e,title:"Log out",skipTaskbar:!0,show:!1,frame:!1,...(i=t.logout)==null?void 0:i.windowConfig});s.webContents.on("did-navigate",()=>{s.destroy(),n&&clearTimeout(n),o()}),s.loadURL(`https://${t.auth0.domain}/v2/logout`),n=setTimeout(()=>{r(new Error("Logout time out"))},60*1e3)})})},C=J;var f=c(require("crypto"));function w(t){return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function N(t){return f.default.createHash("sha256").update(t).digest().toString("base64")}function D(t){return f.default.randomBytes(t).toString("base64")}var H=t=>a("cryptography",{getPKCEChallengePair:()=>{let e=D(32),o=w(e),r=w(N(o));return{verifier:o,challenge:r}}}),P=H;var k=()=>Date.now()/1e3,Q=()=>{let t=null,e;return a("tokens",{async get(){return t},async set(o){t=o,e=k()+o.expires_in},async delete(){t=null},expiredIn:()=>e?e-k():1/0})},b=Q;var F=t=>a("authAPI",{exchangeAuthCode:(e,o)=>fetch(`https://${t.auth0.domain}/oauth/token`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({grant_type:"authorization_code",client_id:t.auth0.clientId,code_verifier:o.verifier,code:e,redirect_uri:`https://${t.auth0.domain}/mobile`})}).then(r=>r.json()),getProfile:e=>fetch(`https://${t.auth0.domain}/userinfo`,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}).then(o=>o.json())}),_=F;var G=t=>a("debug",{log(...e){t.debug&&console.log(...e)}}),T=G;async function g(t){let{cryptography:e,authWindow:o,authAPI:r,tokens:n,debug:{log:s}}=t,i=e.getPKCEChallengePair();s({pair:i});let u=await o.login(i);s({authCode:u});let p=await r.exchangeAuthCode(u,i);return console.log({token:p}),n.set(p),p.access_token}async function O(t){let{tokens:e,debug:{log:o}}=t,r=await e.get();return o({token:r,expired:e.expiredIn()>60}),r&&e.expiredIn()>60?r.access_token:g(t)}async function W(t){let{authWindow:{logout:e},tokens:o}=t;await Promise.all([o.delete(),e()])}async function R(t){let{tokens:e,authAPI:o}=t,r=await e.get();return r?o.getProfile(r.access_token):null}function M(t,e){let o=A(t(e));return{getToken:o(O),getProfile:o(R),login:o(g),logout:o(W)}}var L=M;function $(t){let e=y(C,P,b,_,T);return L(e,t)}
//# sourceMappingURL=index.js.map